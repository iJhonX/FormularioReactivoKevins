<div class="container">
  
  <!-- IZQUIERDA: Formulario -->
  <div class="form-panel">
    <h2>Formulario</h2>
    
    <form [formGroup]="form" (ngSubmit)="enviarFormulario()">
      
      <div class="form-group">
        <label>Link actual</label>
        <input type="text" formControlName="linkActual" readonly placeholder="Navega por Kevins para capturar...">
      </div>

      <div class="form-group">
        <label>T√≠tulo</label>
        <input type="text" formControlName="titulo" placeholder="Nombre el producto..." 
               [class.input-error]="form.get('titulo')?.invalid && form.get('titulo')?.touched">
      </div>

      <div class="form-group">
        <label>Descripci√≥n</label>
        <textarea formControlName="descripcion" rows="6" placeholder="Describe el producto..."
                  [class.input-error]="form.get('descripcion')?.invalid && form.get('descripcion')?.touched"></textarea>
      </div>

      <div class="form-group">
        <label>Keywords</label>
        <input type="text" formControlName="keywords" placeholder="Palabras clave...">
      </div>

      <!-- Mensaje de estado general (√©xito o Error general) -->
      <div class="mensaje-estado exito" *ngIf="mensajeEnvio">{{ mensajeEnvio }}</div>
      <div class="mensaje-estado error" *ngIf="mensajeError">{{ mensajeError }}</div>

      <div class="form-actions">
        <button type="submit" class="btn-enviar">Enviar</button>
        <button type="button" class="btn-exportar" (click)="exportarJson()">Exportar</button>
      </div>

      <!-- Lista de registros guardados con BUSCADOR -->
      <div class="registros-panel" *ngIf="registrosGuardados.length > 0">
        <h3>üìã Registros ({{ registrosGuardados.length }})</h3>
        
        <!-- Buscador -->
        <div class="buscador-container">
          <input 
            type="text" 
            [(ngModel)]="textoBusqueda" 
            [ngModelOptions]="{standalone: true}" 
            placeholder="Buscar registro..." 
            class="input-buscador"
          />
        </div>

        <!-- Recorremos registrosFiltrados -->
        <div class="registro-item" *ngFor="let registro of registrosFiltrados">
          <div class="registro-info">
            <span class="registro-titulo">{{ registro.titulo }}</span>
            <span class="registro-link">{{ registro.link }}</span>
          </div>
          <button type="button" class="btn-eliminar" (click)="eliminarRegistro(registro)" title="Eliminar este registro">üóëÔ∏è</button>
        </div>

        <!-- Mensaje si la b√∫squeda no encuentra nada -->
        <div *ngIf="registrosFiltrados.length === 0 && textoBusqueda.trim() !== ''" class="sin-resultados">
          No se encontraron coincidencias para "{{ textoBusqueda }}"
        </div>

      </div>
    </form>
  </div>

  <!-- DERECHA: Iframe -->
  <div class="iframe-panel">
    
    <!-- BARRA DE NAVEGACI√ìN EDITABLE -->
    <div class="iframe-header">
      <div class="url-bar">
        <span class="url-base">{{ urlBaseKevins }}</span>
        <input 
          type="text" 
          class="url-input"
          [(ngModel)]="rutaEditable" 
          (keyup.enter)="actualizarFrameManual()"
          (blur)="actualizarFrameManual()"
          placeholder="ruta"
        />
        <button class="btn-ir" (click)="actualizarFrameManual()">Ir</button>
      </div>
    </div>

    <div class="iframe-container" #iframeContainer>
      <iframe #miIframe [src]="iframeSafeUrl" frameborder="0" allowfullscreen></iframe>
      
      <div class="loading-overlay" *ngIf="!iframeLoaded">
        <div class="spinner"></div>
        <p>Conectando...</p>
      </div>
    </div>
  </div>
</div>